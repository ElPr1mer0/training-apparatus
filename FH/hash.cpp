#include "hash.h"


////////////////////////////////////////////////////////////////////////
/////////////////////////RECEIVING_EXIST_CODES//////////////////////////
////////////////////////////////////////////////////////////////////////
// Эта функция преобразует входящее число в другой символ для         //
// составления  хэша.                                                 //
int HASH::ReceivingExistCodes(int x){
    x+=256;  // здесь мы из произведения двух прошлых чисел получаем новый символ из след диапазон:
    while(!(((x<=57)&&(x>=48))||((x<=90)&&(x>=65))||((x<=122)&&(x>=97)))){
        if(x<48)x+=24;
        else x-=47;
    }
    return x;
}
////////////////////////////////////////////////////////////////////////
/////////////////////////RECEIVING_EXIST_CODES//////////////////////////
////////////////////////////////////////////////////////////////////////





////////////////////////////////////////////////////////////////////////
/////////////////////////GET_CONTROL_SUM////////////////////////////////
////////////////////////////////////////////////////////////////////////
// Эта функция получает контрольную сумму из имени игрового файла для //
// составления хэша.                                                  //
int HASH::GetControlSum(QString login){
    int sault = 0;  // здесь просто считаем сумму символов из входящей строки

    for(int i = 0; i<login.length();++i){
        sault += login[i].unicode();
    }
    return sault;
}
////////////////////////////////////////////////////////////////////////
/////////////////////////GET_CONTROL_SUM////////////////////////////////
////////////////////////////////////////////////////////////////////////





////////////////////////////////////////////////////////////////////////
////////////////////////////GET_HASH////////////////////////////////////
////////////////////////////////////////////////////////////////////////
// Эта функция уже создает хэш с помощью функций выше                 //
QString HASH::GetHash(QString login){
    QString hash = "";
    int controlSum = GetControlSum(login);   //получим контрольную сумму имени файла, запишем в конец хэша
    int mult, div;

    while(hash.length()<this->hashSize){  // делаем цикл, чтобы hash был не меньше hashSize (сейчас 16)
        for(int i = 0; i<login.length();++i){
           mult = login[i].unicode()*i; // просто рандомные преобразования, чтобы получить часть хэша
           div = login[i].unicode()/(i+1);
           hash+=QChar(ReceivingExistCodes(div)); //QChar здесь нужен для перевода чисел в буквы
           hash+=QChar(ReceivingExistCodes(mult));
        }
        hash += QString::number(controlSum);
        login = hash;
    }

    hash = ""; // обнуляем строку, чтобы туда переписать хэш размером hashSize

    for(int i = 0; i<hashSize;i++){
        hash += login[i];
    }
    return hash;
}
////////////////////////////////////////////////////////////////////////
////////////////////////////GET_HASH////////////////////////////////////
////////////////////////////////////////////////////////////////////////
